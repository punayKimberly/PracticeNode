<!DOCTYPE html>
<html>
  <head>
    <title>
      
        API - Connection |
      
      Tedious
    </title>

    <meta http-equiv="content-type" content="text/html;charset=utf-8" />

    <link type='text/css' rel='stylesheet' href='http://fonts.googleapis.com/css?family=The+Girl+Next+Door'>
    <link type="text/css" rel="stylesheet" href="style/reset.css"/>
    <link type="text/css" rel="stylesheet" href="style/tedious.css"/>
    <link type="text/css" rel="stylesheet" href="style/syntax.css"/>
  </head>

  <body>
    <div class="ribbon">
      <a href="http://github.com/pekim/tedious">
        Fork me on GitHub
      </a>
    </div>

    <div id="navigation">
      <div class="heading">
        <a href="index.html">Tedious</a>
      </div>

      <ul>
        <li>
          <a href="index.html">Overview</a>
        </li>
        <li>
          <a href="installation.html">Installation</a>
        </li>
        <li>
          <a href="getting-started.html">Getting started</a>
        </li>
        <li>
          <a href="parameters.html">Using Parameters</a>
        </li>
        <li>
          <a href="api.html">API</a>
          <ul>
            <li>
              <a href="api-connection.html">
                <code>Connection</code>
              </a>
            </li>
            <li>
              <a href="api-request.html">
                <code>Request</code>
              </a>
            </li>
            <li>
              <a href="api-datatypes.html">Datatypes</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="changelog.html">ChangeLog</a>
        </li>
        <li>
          <a href="licence.html">Licence</a>
        </li>
      </ul>

      <div id="search">
        <form action="https://google.com/search">
          <input type="text" name="q" maxlength="255" value="" placeholder="search" />
          <input type="hidden" name="sitesearch" value="pekim.github.com" />
        </form>
      </div>
    </div>

    <div id="content">
      <h1>Connection</h1>

<p>
  A <code>Connection</code> instance represents a single connection to a database server.
</p>

<p>
  Only one request at a time may be executed on a connection.

  Once a <a href="api-request.html"><code>Request</code></a> has been initiated
  (with <a href="#function_callProcedure"><code>callProcedure</code></a>,
  <a href="#function_execSql"><code>execSql</code></a>, or
  <a href="#function_execSqlBatch"><code>execSqlBatch</code></a>),
  another should not be initiated until the <code>Request</code>'s completion callback is called.
</p>

<ul class="toc">
  <li><a href="#function_newConnection">new Connection(config)</a></li>
  <li><a href="#event_connect">Event: 'connect'</a></li>
  <li><a href="#event_end">Event: 'end'</a></li>
  <li><a href="#event_debug">Event: 'debug'</a></li>
  <li><a href="#event_infoMessage">Event: 'infoMessage'</a></li>
  <li><a href="#event_errorMessage">Event: 'errorMessage'</a></li>
  <li><a href="#event_databaseChange">Event: 'databaseChange'</a></li>
  <li><a href="#event_languageChange">Event: 'languageChange'</a></li>
  <li><a href="#event_charsetChange">Event: 'charsetChange'</a></li>
  <li><a href="#event_secure">Event: 'secure'</a></li>
  <li><a href="#function_beginTransaction">connection.beginTransaction(callback, name, isolationLevel)</a></li>
  <li><a href="#function_callProcedure">connection.callProcedure(request)</a></li>
  <li><a href="#function_close">connection.close()</a></li>
  <li><a href="#function_commitTransaction">connection.commitTransaction(callback)</a></li>
  <li><a href="#function_execSql">connection.execSql(request)</a></li>
  <li><a href="#function_execSqlBatch">connection.execSqlBatch(request)</a></li>
  <li><a href="#function_execute">connection.execute(request, parameters)</a></li>
  <li><a href="#function_prepare">connection.prepare(request)</a></li>
  <li><a href="#function_reset">connection.reset(callback)</a></li>
  <li><a href="#function_rollbackTransaction">connection.rollbackTransaction(callback)</a></li>
  <li><a href="#function_unprepare">connection.unprepare(request)</a></li>
</ul>

<h2 id="function_newConnection">new Connection(config)</h2>
<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Connection</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;tedious&#39;</span><span class="p">).</span><span class="nx">Connection</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{...};</span>
<span class="kd">var</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</code></pre>
</div>


<div class="argument">
  <div class="name">config</div>
  <div class="description">
    <dl>
      <dt>
        <code>userName</code>
      </dt>
      <dd>
        <p>
          User name to use for authentication.
        </p>
        <p>
          Only SQL Server accounts are supported. Windows domain accounts are not supported.
        </p>
      </dd>

      <dt>
        <code>password</code>
      </dt>
      <dd>
        Password to use for authentication.
      </dd>

      <dt>
        <code>server</code>
      </dt>
      <dd>
        Hostname to connect to.
      </dd>

      <dt>
        <code>options.port</code>
      </dt>
      <dd>
        Port to connect to (default: <code>1433</code>).
        <br/>
        Mutually exclusive with <code>options.instanceName</code>.
      </dd>

      <dt>
        <code>options.instanceName</code>
      </dt>
      <dd>
        The instance name to connect to.
        The SQL Server Browser service must be running on the database server,
        and UDP port 1444 on the database server must be reachable.
        <br/>
        (no default)
        <br/>
        Mutually exclusive with <code>options.port</code>.
      </dd>

      <dt>
        <code>options.database</code>
      </dt>
      <dd>
        Database to connect to (default: dependent on server configuration).
      </dd>

      <dt>
        <code>options.connectTimeout</code>
      </dt>
      <dd>
        The number of milliseconds before the attempt to connect is considered failed
        (default: <code>15000</code>).
      </dd>

      <dt>
        <code>options.requestTimeout</code>
      </dt>
      <dd>
        The number of milliseconds before a request is considered failed
        (default: <code>15000</code>).
      </dd>

      <dt>
        <code>options.cancelTimeout</code>
      </dt>
      <dd>
        The number of milliseconds before the cancel (abort) of a request is considered failed
        (default: <code>5000</code>).
      </dd>

      <dt>
        <code>options.packetSize</code>
      </dt>
      <dd>
        The size of TDS packets (subject to negotiation with the server).
        Should be a power of 2.
        (default: <code>4096</code>).
      </dd>

      <dt>
        <code>options.debug.packet</code>
      </dt>
      <dd>
        A boolean, controlling whether <code>debug</code> events will be emitted with text describing packet details
        (default: <code>false</code>).
      </dd>

      <dt>
        <code>options.debug.data</code>
      </dt>
      <dd>
        A boolean, controlling whether <code>debug</code> events will be emitted with text describing packet data details
        (default: <code>false</code>).
      </dd>

      <dt>
        <code>options.debug.payload</code>
      </dt>
      <dd>
        A boolean, controlling whether <code>debug</code> events will be emitted with text describing packet payload details
        (default: <code>false</code>).
      </dd>

      <dt>
        <code>options.debug.token</code>
      </dt>
      <dd>
        A boolean, controlling whether <code>debug</code> events will be emitted with text describing token stream tokens
        (default: <code>false</code>).
      </dd>

      <dt>
        <code>options.isolationLevel</code>
      </dt>
      <dd>
        The default isolation level that transactions will be run with.
        The isolation levels are available from <code>require('tedious').ISOLATON_LEVEL</code> .
        <ul>
          <li><code>READ_UNCOMMITTED</code></li>
          <li><code>READ_COMMITTED</code></li>
          <li><code>REPEATABLE_READ</code></li>
          <li><code>SERIALIZABLE</code></li>
          <li><code>SNAPSHOT</code></li>
        </ul>
        (default: <code>READ_UNCOMMITED</code>).
      </dd>

      <dt>
        <code>options.encrypt</code>
      </dt>
      <dd>
        A boolean determining whether or not the connection will be encrypted.
        (default: <code>false</code>).
        <br/>
        Encryption support is experimental.
      </dd>

      <dt>
        <code>options.cryptoCredentialsDetails</code>
      </dt>
      <dd>
        When encryption is used, an object may be supplied that will be used
        for the first argument when calling
        <a href="http://nodejs.org/docs/latest/api/tls.html#tls_tls_createsecurepair_credentials_isserver_requestcert_rejectunauthorized">tls.createSecurePair</a>
        (default: <code>{}</code>).
      </dd>

        <dt>
            <code>options.rowCollectionOnDone</code>
        </dt>
        <dd>
            A boolean, that when true will expose received rows in Requests' <code>done*</code> events.
            See <a href="api-request.html#event_done">done</a>,
            <a href="api-request.html#event_doneInProc">doneInProc</a>
            and <a href="api-request.html#event_doneProc">doneProc</a>.
            (default: <code>false</code>)

            <p>
                Caution: If many row are received, enabling this option could result in
                excessive memory usage.
            </p>
        </dd>

      <dt>
          <code>options.rowCollectionOnRequestCompletion</code>
      </dt>
      <dd>
          A boolean, that when true will expose received rows in Requests' completion callback.
          See <a href="api-request.html#function_newRequest">new Request</a>.
          (default: <code>false</code>)

          <p>
              Caution: If many row are received, enabling this option could result in
              excessive memory usage.
          </p>
      </dd>

      <dt>
        <code>options.tdsVersion</code>
      </dt>
      <dd>
        The version of TDS to use.
        The version are available from <code>require('tedious').TDS_VERSION</code> .
        <ul>
          <li><code>7_1</code> (limited support)</li>
          <li><code>7_2</code></li>
          <li><code>7_3_A</code> (future use)</li>
          <li><code>7_3_B</code> (future use)</li>
        </ul>
        (default: <code>7_2</code>).
      </dd>
    </dl>
  </div>
</div>

<h2 id="event_connect">Event: 'connect'</h2>
<span class="function">function (err) { }</span>
<p>
  The attempt to connect and validate has completed.
</p>
<div class="argument">
  <div class="name">err</div>
  <div class="description">
    <p>
      If successfully connected, will be falsey.
    </p>
    <p>
      If there was a problem (with either connecting or validation), will be a string
      with details of the error.
    </p>
  </div>
</div>

<h2 id="event_end">Event: 'end'</h2>
<span class="function">function () { }</span>
<p>
  The connection has ended.
  This may be as a result of the client calling <code>close()</code>, the server closing the connection, or a network error.
</p>

<h2 id="event_debug">Event: 'debug'</h2>
<span class="function">function (messageText) { }</span>
<p>
  A debug message is available.
  It may be logged or ignored.
</p>
<div class="argument">
  <div class="name">messageText</div>
  <div class="description">
    <p>
      The debug message.
    </p>
  </div>
</div>

<h2 id="event_infoMessage">Event: 'infoMessage'</h2>
<span class="function">function (info) { }</span>
<p>
  The server has issued an information message.
</p>
<div class="argument">
  <div class="name">info</div>
  <div class="description">
    <p>
      An object with these properties:
    </p>
    <dl>
      <dt><code>number</code></dt>
      <dd>Error number</dd>
    </dl>
    <dl>
      <dt><code>state</code></dt>
      <dd>The error state, used as a modifier to the error number.</dd>
    </dl>
    <dl>
      <dt><code>class</code></dt>
      <dd>The class (severity) of the error. A class of less than 10 indicates an informational message.</dd>
    </dl>
    <dl>
      <dt><code>message</code></dt>
      <dd>The message text.</dd>
    </dl>
    <dl>
      <dt><code>procName</code></dt>
      <dd>The stored procedure name (if a stored procedure generated the message).</dd>
    </dl>
    <dl>
      <dt><code>lineNumber</code></dt>
      <dd>
        The line number in the SQL batch or stored procedure that caused the error.
        Line numbers begin at 1; therefore, if the line number is not applicable to the message,
        the value of LineNumber will be 0.
      </dd>
    </dl>
  </div>
</div>

<h2 id="event_errorMessage">Event: 'errorMessage'</h2>
<span class="function">function (error) { }</span>
<p>
  The server has issued an error message.
</p>
<div class="argument">
  <div class="name">error</div>
  <div class="description">
    <p>
      An object with the same properties as.listed for the
      <code>infoMessage</code> event.
    </p>
  </div>
</div>


<h2 id="event_databaseChange">Event: 'databaseChange'</h2>
<span class="function">function (databaseName) { }</span>
<p>
  The server has reported that the active database has changed.
  This may be as a result of a sucessful login, or a <code>use</code> statement.
</p>
<div class="argument">
  <div class="name">databaseName</div>
  <div class="description">
    <p>
      The name of the new active database
    </p>
  </div>
</div>

<h2 id="event_languageChange">Event: 'languageChange'</h2>
<span class="function">function (languageName) { }</span>
<p>
  The server has reported that the language has changed.
</p>
<div class="argument">
  <div class="name">languageName</div>
  <div class="description">
    <p>
      The newly active language.
    </p>
  </div>
</div>

<h2 id="event_charsetChange">Event: 'charsetChange'</h2>
<span class="function">function (charset) { }</span>
<p>
  The server has reported that the charset has changed.
</p>
<div class="argument">
  <div class="name">charset</div>
  <div class="description">
    <p>
      The new charset.
    </p>
  </div>
</div>

<h2 id="event_secure">Event: 'secure'</h2>
<span class="function">function (cleartext) { }</span>
<p>
  A secure connection has been established.
</p>
<div class="argument">
  <div class="name">cleartext</div>
  <div class="description">
    <p>
      The
      <a href="http://nodejs.org/docs/latest/api/tls.html#tls_class_tls_cleartextstream">
        <code>cleartext</code>
      </a>
      stream of a tls SecurePair.
      The <a href="http://nodejs.org/docs/latest/api/tls.html#tls_cleartextstream_getcipher">cipher</a>
      and <a href="http://nodejs.org/docs/latest/api/tls.html#tls_cleartextstream_getpeercertificate">peer certificate</a>
      (server certificate) may be inspected if desired.
    </p>
  </div>
</div>

<h2 id="function_beginTransaction">connection.beginTransaction(callback, name, isolationLevel)</h2>
<p>
  Start a transaction.
</p>
<div class="argument">
  <div class="name">callback</div>
  <div class="description">
    <span class="function">function (err) { }</span>
    <p>
      The callback is called when the request to start the transaction has completed,
      either successfully or with an error.
      If an error occured then <code>err</code> will describe the error.
    </p>
    <p>
      As only one request at a time may be executed on a connection, another request should not
      be initiated until this callback is called.
    </p>
    <div class="argument">
      <div class="name">err</div>
      <div class="description">
        <p>
          If an error occured, a string with details of the error.
        </p>
      </div>
    </div>
  </div>
</div>
<div class="argument">
  <div class="name">name</div>
  <div class="description">
    <p>
      A string representing a name to associate with the transaction.
    </p>
    <p>
      Optional, and defaults to an empty string.
      Required when <code>isolationLevel</code> is present.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">isolationLevel</div>
  <div class="description">
    <p>
      The isolation level that the transaction is to be run with.
      The isolation levels are available from <code>require('tedious').ISOLATON_LEVEL</code> .
      <ul>
        <li><code>READ_UNCOMMITTED</code></li>
        <li><code>READ_COMMITTED</code></li>
        <li><code>REPEATABLE_READ</code></li>
        <li><code>SERIALIZABLE</code></li>
        <li><code>SNAPSHOT</code></li>
      </ul>
    </p>
    <p>
      Optional, and defaults to the Connection's isolation level.
    </p>
  </div>
</div>

<h2 id="function_callProcedure">connection.callProcedure(request)</h2>
<p>
  Call a stored procedure represented by <code>request</code>.
</p>
<div class="argument">
  <div class="name">request</div>
  <div class="description">
    <p>
      A <a href="api-request.html"><code>Request</code></a>
      object representing the request.
    </p>
  </div>
</div>

<h2 id="function_close">connection.close()</h2>
<p>
  Closes the connection to the database.
</p>
<p>
  The <a href="#event_end"><code>end</code></a> will be emmited once the connection has been closed.
</p>

<h2 id="function_execSql">connection.execSql(request)</h2>
<p>
  Execute the SQL represented by <code>request</code>.
</p>
<p>
  As <code>sp_executesql</code> is used to execute the SQL,
  if the same SQL is executed multiples times using this function,
  the SQL Server query optimizer is likely to reuse the execution plan it generates for the first execution.
</p>
<p>
  Beware of the way that scoping rules apply, and how they may
  <a href="http://weblogs.sqlteam.com/mladenp/archive/2006/11/03/17197.aspx">affect local temp tables</a>.
  If you're running in to scoping issues, then <code>execSqlBatch</code> may be a better choice.
  See also <a href="https://github.com/pekim/tedious/issues/24">issue #24</a>.
</p>
<div class="argument">
  <div class="name">request</div>
  <div class="description">
    <p>
      A <a href="api-request.html"><code>Request</code></a>
      object representing the request.
    </p>
  </div>
</div>

<h2 id="function_commitTransaction">connection.commitTransaction(callback)</h2>
<p>
  Commit a transaction.
</p>
<p>
  There should be an active transaction.
  That is, <a href="#function_beginTransaction"><code>beginTransaction</code></a> should have been previously called.
</p>
<div class="argument">
  <div class="name">callback</div>
  <div class="description">
    <span class="function">function (err) { }</span>
    <p>
      The callback is called when the request to commit the transaction has completed,
      either successfully or with an error.
      If an error occured then <code>err</code> will describe the error.
    </p>
    <p>
      As only one request at a time may be executed on a connection, another request should not
      be initiated until this callback is called.
    </p>
    <div class="argument">
      <div class="name">err</div>
      <div class="description">
        <p>
          If an error occured, a string with details of the error.
        </p>
      </div>
    </div>
  </div>
</div>

<h2 id="function_execSqlBatch">connection.execSqlBatch(request)</h2>
<p>
  Execute the SQL batch represented by <code>request</code>.
  There is no param support, and unlike <code>execSql</code>,
  it is not likely that SQL Server will reuse the execution plan it generates for the SQL.
</p>
<p>
  In almost all cases, <code>execSql</code> will be a better choice.
</p>
<div class="argument">
  <div class="name">request</div>
  <div class="description">
    <p>
      A <a href="api-request.html"><code>Request</code></a>
      object representing the request.
    </p>
  </div>
</div>

<h2 id="function_execute">connection.execute(request, parameters)</h2>
<p>
  Execute previously prepared SQL, using the supplied parameters.
</p>
<div class="argument">
  <div class="name">request</div>
  <div class="description">
    <p>
      A previously prepared <a href="api-request.html"><code>Request</code></a>.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">parameters</div>
  <div class="description">
    <p>
      An object whose names correspond to the names of parameters that were added to the
      <code>request</code> before it was prepared.
      The object's values are passed as the parameters' values when the request is executed.
    </p>
  </div>
</div>

<h2 id="function_prepare">connection.prepare(request)</h2>
<p>
    Prepare the SQL represented by the request.
    The request can then be used in subsequent calls to
    <a href="#function_execute">execute</a> and <a href="#function_unprepare">unprepare</a>
</p>
<div class="argument">
    <div class="name">request</div>
    <div class="description">
        <p>
            A <a href="api-request.html"><code>Request</code></a>
            object representing the request.
        </p>
        <p>
            Parameters only require a name and type.
            Parameter values are ignored.
        </p>
    </div>
</div>

<h2 id="function_reset">connection.reset(callback)</h2>
<p>
    Reset the connection to its initial state.
    Can be useful for connection pool implementations.
</p>
<div class="argument">
    <div class="name">callback</div>
    <div class="description">
        <span class="function">function (err) { }</span>
        <p>
            The callback is called when the connection reset has completed,
            either successfully or with an error.
            If an error occured then <code>err</code> will describe the error.
        </p>
        <p>
            As only one request at a time may be executed on a connection, another request should not
            be initiated until this callback is called.
        </p>
        <div class="argument">
            <div class="name">err</div>
            <div class="description">
                <p>
                    If an error occured, a string with details of the error.
                </p>
            </div>
        </div>
    </div>
</div>

<h2 id="function_rollbackTransaction">connection.rollbackTransaction(callback)</h2>
<p>
  Rollback a transaction.
</p>
<p>
  There should be an active transaction.
  That is, <a href="#function_beginTransaction"><code>beginTransaction</code></a> should have been previously called.
</p>
<div class="argument">
  <div class="name">callback</div>
  <div class="description">
    <span class="function">function (err) { }</span>
    <p>
      The callback is called when the request to rollback the transaction has completed,
      either successfully or with an error.
      If an error occured then <code>err</code> will describe the error.
    </p>
    <p>
      As only one request at a time may be executed on a connection, another request should not
      be initiated until this callback is called.
    </p>
    <div class="argument">
      <div class="name">err</div>
      <div class="description">
        <p>
          If an error occured, a string with details of the error.
        </p>
      </div>
    </div>
  </div>
</div>

<h2 id="function_unprepare">connection.unprepare(request)</h2>
<p>
  Release the SQL Server resources associated with a previously prepared request.
</p>
<div class="argument">
  <div class="name">request</div>
  <div class="description">
    <p>
      The request to be unprepared.
    </p>
  </div>
</div>

    </div>

    <div id="footer">
      Copyright &copy; 2011-2013 Mike D Pilsbury
    </div>
  </body>
</html>
