<!DOCTYPE html>
<html>
  <head>
    <title>
      
        API - Request |
      
      Tedious
    </title>

    <meta http-equiv="content-type" content="text/html;charset=utf-8" />

    <link type='text/css' rel='stylesheet' href='http://fonts.googleapis.com/css?family=The+Girl+Next+Door'>
    <link type="text/css" rel="stylesheet" href="style/reset.css"/>
    <link type="text/css" rel="stylesheet" href="style/tedious.css"/>
    <link type="text/css" rel="stylesheet" href="style/syntax.css"/>
  </head>

  <body>
    <div class="ribbon">
      <a href="http://github.com/pekim/tedious">
        Fork me on GitHub
      </a>
    </div>

    <div id="navigation">
      <div class="heading">
        <a href="index.html">Tedious</a>
      </div>

      <ul>
        <li>
          <a href="index.html">Overview</a>
        </li>
        <li>
          <a href="installation.html">Installation</a>
        </li>
        <li>
          <a href="getting-started.html">Getting started</a>
        </li>
        <li>
          <a href="parameters.html">Using Parameters</a>
        </li>
        <li>
          <a href="api.html">API</a>
          <ul>
            <li>
              <a href="api-connection.html">
                <code>Connection</code>
              </a>
            </li>
            <li>
              <a href="api-request.html">
                <code>Request</code>
              </a>
            </li>
            <li>
              <a href="api-datatypes.html">Datatypes</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="changelog.html">ChangeLog</a>
        </li>
        <li>
          <a href="licence.html">Licence</a>
        </li>
      </ul>

      <div id="search">
        <form action="https://google.com/search">
          <input type="text" name="q" maxlength="255" value="" placeholder="search" />
          <input type="hidden" name="sitesearch" value="pekim.github.com" />
        </form>
      </div>
    </div>

    <div id="content">
      <h1>Request</h1>

<p>
  A <code>Request</code> instance represents a request that can be executed on a connection.
</p>

<ul class="toc">
  <li><a href="#function_newRequest">new Request(sql, callback)</a></li>
  <li><a href="#event_columnMetadata">Event: 'columnMetadata'</a></li>
  <li><a href="#event_row">Event: 'row'</a></li>
  <li><a href="#event_done">Event: 'done'</a></li>
  <li><a href="#event_doneInProc">Event: 'doneInProc'</a></li>
  <li><a href="#event_doneProc">Event: 'doneProc'</a></li>
  <li><a href="#event_returnValue">Event: 'returnValue'</a></li>
  <li><a href="#function_addParameter">request.addParameter(name, type, value)</a></li>
  <li><a href="#function_addOutputParameter">request.addOutputParameter(name, type)</a></li>
</ul>

<h2 id="function_newRequest">new Request(sql, callback)</h3>
<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;tedious&#39;</span><span class="p">).</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">(</span><span class="s2">&quot;select 42, &#39;hello world&#39;&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rowCount</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span>
<span class="nx">connection</span><span class="p">.</span><span class="nx">execSql</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
</code></pre>
</div>


<div class="argument">
  <div class="name">sql</div>
  <div class="description">
    <p>
      The SQL to be executed
      (or a procedure name, if the request is to be used with
      <a href="api-connection.html#function_callProcedure"><code>connection.callProcedure</code></a>).
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">callback</div>
  <div class="description">
    <span class="function">function (err, rowCount, rows) { }</span>
    <p>
      The callback is called when the request has completed, either successfully or with an error.
      If an error occurs during execution of the statement(s), then <code>err</code> will describe the error.
    </p>
    <p>
      As only one request at a time may be executed on a connection, another request should not
      be initiated until this callback is called.
    </p>
    <div class="argument">
      <div class="name">err</div>
      <div class="description">
        <p>
          If an error occured, a string with details of the error.
        </p>
      </div>
    </div>
      <div class="argument">
          <div class="name">rowCount</div>
          <div class="description">
              <p>
                  The number of rows emitted as result of executing the SQL.
              </p>
          </div>
      </div>
      <div class="argument">
          <div class="name">rows</div>
          <div class="description">
              <p>
                  Rows as a result of executing the SQL.
              </p>
              <p>
                  Will only be avaiable if Connection's
                  <code>config.options.rowCollectionOnRequestCompletion</code>
                  is <code>true</code>.
              </p>
          </div>
      </div>
  </div>
</div>

<h2 id="event_columnMetadata">Event: columnMetadata</h2>
<code>function (columns) { }</code>
<p>
  This event, describing result set columns, will be emitted before <code>row</code> events are emitted.
</p>
<div class="argument">
  <div class="name">columns</div>
  <div class="description">
    <p>
      An array like object, where the columns can be accessed either by index or name.
      Columns with a name that is an integer are not accessible by name,
      as it would be interpreted as an array index.
    </p>
    <p>
      Each column has these properties.
    </p>
    <dl>
      <dt>
        <code>colName</code>
      </dt>
      <dd>
        The column's name.
      </dd>

      <dt>
        <code>type.name</code>
      </dt>
      <dd>
        The column's type, such as VarChar, Int or Binary.
      </dd>

      <dt>
        <code>precision</code>
      </dt>
      <dd>
        The precision. Only applicable to types such as numeric and decimal.
      </dd>

      <dt>
        <code>scale</code>
      </dt>
      <dd>
        The scale. Only applicable to types such as numeric and decimal.
      </dd>

      <dt>
        <code>dataLength</code>
      </dt>
      <dd>
        The length, for types such as char, varchar, narchar and nvarchar.
      </dd>
    </dl>
  </div>
</div>

<h2 id="event_row">Event: row</h2>
<code>function (columns) { }</code>
<p>
  A row resulting from execution of the SQL.
</p>
<div class="argument">
  <div class="name">columns</div>
  <div class="description">
    <p>
      An array like object, where the columns can be accessed either by index or name.
      Each column has two properties, <code>metadata</code> and <code>value</code>.
    </p>
    <dl>
      <dt>
        <code>metadata</code>
      </dt>
      <dd>
        The same data that is exposed in the <code>columnMetadata</code> event.
      </dd>

      <dt>
        <code>value</code>
      </dt>
      <dd>
        <p>
          The column's value.
          It will be <code>null</code> for a <code>NULL</code>.
        </p>
        <p>
          If there are multiple columns with the same name, then this will be an array of the values.
	</p>
      </dd>
    </dl>
  </div>
</div>

<h2 id="event_done">Event: done</h2>
<p>
  <em>This is a relatively low-level event, driven by the receipt of a TDS Done token.
  Most uses of Tedious can ignore this event, and should rely on the Request's callback function to
  know when the request has completed.</em>
</p>
<code>function (rowCount, more, rows) { }</code>
<p>
  All rows from a result set have been provided (through <code>row</code> events).
</p>
<div class="argument">
  <div class="name">rowCount</div>
  <div class="description">
    <p>
      The number of result rows.
      May be <code>undefined</code> if not available.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">more</div>
  <div class="description">
    <p>
      If there are more results to come (probably because multiple statements are being executed),
      then <code>true</code>.
    </p>
  </div>
</div>
<div class="argument">
    <div class="name">rows</div>
    <div class="description">
        <p>
            Rows as a result of executing the SQL.
        </p>
        <p>
            Will only be avaiable if Connection's
            <code>config.options.rowCollectionOnDone</code>
            is <code>true</code>.
        </p>
    </div>
</div>

<h2 id="event_doneInProc">Event: doneInProc</h2>
<p>
  <em>This is a relatively low-level event, driven by the receipt of a TDS DoneInProc token.
  Most uses of Tedious can ignore this event, and should rely on the Request's callback function to
  know when the request has completed.</em>
</p>
<code>function (rowCount, more, rows) { }</code>
<p>
  All rows from a statement in a stored procedure have been provided (through <code>row</code> events).
</p>
<div class="argument">
  <div class="name">rowCount</div>
  <div class="description">
    <p>
      The number of result rows.
      May be <code>undefined</code> if not available.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">more</div>
  <div class="description">
    <p>
      If there are more result sets to come,
      then <code>true</code>.
    </p>
  </div>
</div>
<div class="argument">
    <div class="name">rows</div>
    <div class="description">
        <p>
            Rows as a result of executing the SQL.
        </p>
        <p>
            Will only be avaiable if Connection's
            <code>config.options.rowCollectionOnDone</code>
            is <code>true</code>.
        </p>
    </div>
</div>

<h2 id="event_doneProc">Event: doneProc</h2>
<p>
  <em>This is a relatively low-level event, driven by the receipt of a TDS DoneProc token.
  Most uses of Tedious can ignore this event, and should rely on the Request's callback function to
  know when the request has completed.</em>
</p>
<code>function (rowCount, more, returnStatus, rows) { }</code>
</p>
  A stored procedure has been completed.
</p>
<div class="argument">
  <div class="name">rowCount</div>
  <div class="description">
    <p>
      The number of result rows.
      May be <code>undefined</code> if not available.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">more</div>
  <div class="description">
    <p>
      If there are more result sets to come,
      then <code>true</code>.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">returnStatus</div>
  <div class="description">
    <p>
      The value returned from a stored procedure.
    </p>
  </div>
</div>
<div class="argument">
    <div class="name">rows</div>
    <div class="description">
        <p>
            Rows as a result of executing the SQL.
        </p>
        <p>
            Will only be avaiable if Connection's
            <code>config.options.rowCollectionOnDone</code>
            is <code>true</code>.
        </p>
    </div>
</div>

<h2 id="event_returnValue">Event: returnValue</h2>
<code>function (parameterName, value, metadata) { }</code>
<p>
  A value for an output parameter
  (that was added to the request with
  <a href="#function_addOutputParameter"><code>addOutputParameter(...)</code></a>).
</p>
<p>
  See also <a href="parameters.html"><code>Using Parameters</code></a>.
</p>
<div class="argument">
  <div class="name">parameterName</div>
  <div class="description">
    <p>
      The parameter name.
      (Does not start with '@'.)
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">value</div>
  <div class="description">
    <p>
      The parameter's output value.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">metadata</div>
  <div class="description">
    <p>
      The same data that is exposed in the <code>columnMetadata</code> event.
    </p>
  </div>
</div>

<h2 id="function_addParameter">request.addParameter(name, type, value)</h2>
<p>
  Add an input parameter to the request.
</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">request</span><span class="p">.</span><span class="nx">addParameter</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">TYPES</span><span class="p">.</span><span class="nx">VarChar</span><span class="p">,</span> <span class="s1">&#39;London&#39;</span><span class="p">);</span>
</code></pre>
</div>

<p>
  See also <a href="parameters.html"><code>Using Parameters</code></a>.
</p>
<div class="argument">
  <div class="name">name</div>
  <div class="description">
    <p>
      The parameter name.
      This should correspond to a parameter in the SQL,
      or a parameter that a called procedure expects.
    </p>
    <p>
      The name should not start '@'.
    </p>
  </div>

  <div class="name">type</div>
  <div class="description">
    <p>
      One of the supported <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>

  <div class="name">value</div>
  <div class="description">
    <p>
      The value that the parameter is to be given.
      The Javascript type of the argument should match
      that documented for <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>
</div>

<h2 id="function_addOutputParameter">request.addOutputParameter(name, type)</h2>
<p>
  Add an output parameter to the request.
</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">request</span><span class="p">.</span><span class="nx">addOutputParameter</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">TYPES</span><span class="p">.</span><span class="nx">Int</span><span class="p">);</span>
</code></pre>
</div>

<p>
  The parameter's value will be provide by an emitted
  <a href="#event_returnValue"><code>returnValue</code></a> event.
</p>
<p>
  See also <a href="parameters.html"><code>Using Parameters</code></a>.
</p>
<div class="argument">
  <div class="name">name</div>
  <div class="description">
    <p>
      The parameter name.
      This should correspond to a parameter in the SQL,
      or a parameter that a called procedure expects.
    </p>
  </div>

  <div class="name">type</div>
  <div class="description">
    <p>
      One of the supported <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>
</div>

    </div>

    <div id="footer">
      Copyright &copy; 2011-2013 Mike D Pilsbury
    </div>
  </body>
</html>
